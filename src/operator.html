<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umbrellaprompter</title>
  <link rel="stylesheet" href="css/operator.css">
</head>
<body>
  <header class="header">
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 512 512" fill="none">
          <defs>
            <linearGradient id="umbrellaGrad" x1="0" y1="0" x2="512" y2="512" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#00C6FB"/>
              <stop offset="100%" stop-color="#005BEA"/>
            </linearGradient>
            <mask id="iconCutout" maskUnits="userSpaceOnUse" x="0" y="0" width="512" height="512">
              <rect width="512" height="512" rx="100" fill="white"/>
              <g fill="black">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M256 120C183.107 120 124 179.107 124 252H164C164 201.189 205.189 160 256 160C306.811 160 348 201.189 348 252H388C388 179.107 328.893 120 256 120Z"/>
                <path d="M174 272L202 360H310L338 272H174Z"/>
                <rect x="215" y="300" width="82" height="12" rx="6"/>
                <rect x="215" y="324" width="50" height="12" rx="6"/>
              </g>
            </mask>
          </defs>
          <rect width="512" height="512" rx="100" fill="url(#umbrellaGrad)" mask="url(#iconCutout)"/>
        </svg>
      </div>
      <span class="logo-text">Umbrellaprompter</span>
    </div>

    <div class="header-divider"></div>

    <button class="btn" id="openFileBtn">
      <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/></svg>
      Open
    </button>
    <button class="btn ghost" id="newScriptBtn">New</button>

    <div class="header-divider"></div>

    <button class="btn" id="saveProjectBtn">
      <svg viewBox="0 0 24 24"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4z"/></svg>
      Save Project
    </button>
    <button class="btn" id="loadProjectBtn">Load Project</button>

    <div class="header-divider"></div>

    <button class="btn primary" id="sendScriptBtn">
      <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      Send to Display
    </button>

    <div class="file-indicator">
      <span class="dot"></span>
      <span id="fileName">No file loaded</span>
    </div>

    <div class="version-info">
      <span class="version-badge" id="versionBadge">v1.0.0</span>
      <button class="btn btn-check-updates" id="checkUpdatesBtn">Check for Updates</button>
    </div>
  </header>

  <!-- Update Banner -->
  <div class="update-banner" id="updateBanner">
    <svg class="update-banner-icon" viewBox="0 0 24 24">
      <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
    </svg>
    <div class="update-banner-text" id="updateText">
      Update available <span id="updateVersion"></span>
    </div>
    <button class="btn" id="updateActionBtn">Download</button>
    <button class="update-banner-close" id="updateCloseBtn">
      <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
    </button>
  </div>

  <main class="main">
    <div class="script-panel">
      <div class="script-header">
        <h2>Script</h2>
        <div class="script-meta">
          <div class="view-toggle">
            <button class="btn active" id="viewEditorBtn">Editor</button>
            <button class="btn" id="viewMonitorBtn">Monitor</button>
          </div>
          <span class="char-count" id="charCount">0 characters</span>
        </div>
      </div>
      <div class="script-content">
        <div class="script-editor active" id="editorView">
          <textarea id="scriptText" placeholder="Start typing your script here, or open a Word document..."></textarea>
        </div>
        <div class="script-monitor" id="monitorView">
          <div class="monitor-container" id="monitorContainer">
            <!-- Scaled clone of teleprompter - renders at teleprompter size then scaled down -->
            <div class="monitor-preview-frame">
              <div class="monitor-preview" id="monitorPreview">
                <!-- Inner container for mirror/flip transforms (separate from scale) -->
                <div class="monitor-flip-container" id="monitorFlipContainer">
                  <div class="gradient-top"></div>
                  <div class="reading-guide"></div>
                  <div class="script-wrapper" id="monitorScriptWrapper">
                    <div class="script-text" id="monitorScriptText">Waiting for script...</div>
                  </div>
                  <div class="gradient-bottom"></div>
                  <!-- Countdown Overlay -->
                  <div class="monitor-countdown-overlay" id="monitorCountdownOverlay">
                    <div class="monitor-countdown-number" id="monitorCountdownNumber">3</div>
                    <div class="monitor-countdown-text">Starting in...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="monitor-progress">
            <div class="monitor-progress-bar" id="monitorProgressBar"></div>
          </div>
          <div class="monitor-status">
            <div class="status-badge">
              <div class="status-dot" id="monitorStatusDot"></div>
              <span id="monitorStatusText">Ready</span>
            </div>
            <button class="btn" id="addCueFromMonitorBtn" style="padding: 4px 8px; font-size: 10px;">
              <svg viewBox="0 0 24 24" style="width: 12px; height: 12px;"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
              Add Cue
            </button>
            <span id="monitorPercent">0%</span>
          </div>
        </div>
      </div>
    </div>

    <aside class="control-panel">
      <!-- Display -->
      <div class="control-section">
        <div class="section-header">
          <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg>
          <h3>Display Output</h3>
        </div>
        <div class="select-wrapper" style="display: flex; gap: 6px;">
          <select id="displaySelect" style="flex: 1;">
            <option value="">Select display...</option>
          </select>
          <button class="btn" id="refreshDisplaysBtn" title="Refresh displays" style="padding: 8px 10px;">
            <svg viewBox="0 0 24 24" style="width: 14px; height: 14px;"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
          </button>
        </div>
        <div class="button-row">
          <button class="btn success" id="openDisplayBtn">Open Display</button>
          <button class="btn" id="closeDisplayBtn">Close</button>
        </div>
      </div>

      <!-- Playback -->
      <div class="control-section">
        <div class="section-header">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          <h3>Playback</h3>
        </div>
        <div class="playback-main">
          <button class="btn primary btn-play" id="playPauseBtn">
            <svg viewBox="0 0 24 24" id="playIcon"><path d="M8 5v14l11-7z"/></svg>
            <span id="playText">Play</span>
          </button>
          <button class="btn btn-reset" id="stopBtn">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
          </button>
        </div>

        <div class="toggle-row">
          <label for="countdownCheckbox">Countdown before start</label>
          <label class="toggle">
            <input type="checkbox" id="countdownCheckbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="countdown-row" id="countdownRow">
          <label>Seconds:</label>
          <input type="number" id="countdownSeconds" value="3" min="1" max="10">
        </div>

        <div class="slider-group" style="margin-top: 12px;">
          <div class="slider-label">
            <span>Speed</span>
            <span class="slider-value" id="speedValue">30</span>
          </div>
          <input type="range" id="speedSlider" min="1" max="100" value="30">
        </div>

        <!-- Voice Follow -->
        <div class="voice-follow-section">
          <div class="voice-follow-header">
            <label for="voiceFollowCheckbox">
              <svg class="mic-icon" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
              Voice Follow
            </label>
            <label class="toggle">
              <input type="checkbox" id="voiceFollowCheckbox">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Whisper Info -->
          <div style="font-size: 10px; color: var(--text-tertiary); margin-bottom: 8px;">
            Uses Whisper AI - runs locally, free. First use downloads ~280MB model.
          </div>
          <!-- Whisper Model Status -->
          <div id="whisperModelStatus" style="display: none; margin-bottom: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: var(--radius-sm); font-size: 11px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div id="whisperModelSpinner" class="spinner" style="width: 14px; height: 14px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
              <span id="whisperModelStatusText">Loading Whisper model...</span>
            </div>
            <div id="whisperModelProgress" style="margin-top: 6px; height: 4px; background: var(--bg-secondary); border-radius: 2px; overflow: hidden;">
              <div id="whisperModelProgressBar" style="height: 100%; background: var(--accent); width: 0%; transition: width 0.3s;"></div>
            </div>
          </div>
          <div class="voice-input-select" style="margin-bottom: 8px;">
            <select id="audioInputSelect" style="width: 100%; padding: 6px 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text-primary); font-size: 11px;">
              <option value="">Default Microphone</option>
            </select>
          </div>
          <div class="voice-status" id="voiceStatus">
            <div class="voice-indicator"></div>
            <span id="voiceStatusText">Off</span>
            <button class="btn" id="voicePauseBtn" style="display: none; margin-left: auto; padding: 2px 8px; font-size: 10px;">Pause</button>
          </div>
          <div class="voice-transcript" id="voiceTranscript" style="display: none;">
            Listening...
          </div>
          <div class="voice-debug" id="voiceDebug" style="display: none; margin-top: 6px; padding: 6px; background: var(--bg-tertiary); border-radius: var(--radius-sm); font-size: 10px; color: var(--text-secondary);">
            <div>Word: <span id="debugMatchedWord" style="color: #22c55e; font-weight: bold;">-</span></div>
            <div>Index: <span id="debugWordIndex">0</span> / <span id="debugTotalWords">0</span></div>
          </div>
        </div>
      </div>

      <!-- Position -->
      <div class="control-section">
        <div class="section-header">
          <svg viewBox="0 0 24 24"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/></svg>
          <h3>Position</h3>
        </div>
        <div class="slider-group">
          <div class="slider-label">
            <span>Scroll Position</span>
            <span class="slider-value" id="positionValue">0%</span>
          </div>
          <input type="range" id="positionSlider" min="0" max="100" value="0">
        </div>
        <div class="position-actions">
          <button class="btn" id="jumpStartBtn">Start</button>
          <button class="btn" id="jumpCursorBtn" title="Jump to cursor position in editor">Cursor</button>
          <button class="btn" id="jumpEndBtn">End</button>
        </div>
        <!-- Find in script -->
        <div style="margin-top: 10px;">
          <div style="display: flex; gap: 6px;">
            <input type="text" id="findTextInput" placeholder="Find text..." style="flex: 1; padding: 6px 8px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius-md); color: var(--text-primary); font-size: 12px;">
            <button class="btn" id="findTextBtn" style="padding: 6px 10px;">Find</button>
          </div>
        </div>
      </div>

      <!-- Appearance & Cues Tabs -->
      <div class="control-section">
        <div class="tabs">
          <div class="tab active" data-tab="appearance">Appearance</div>
          <div class="tab" data-tab="cues">Cue Markers</div>
          <div class="tab" data-tab="remote">Remote</div>
        </div>

        <!-- Appearance Tab -->
        <div class="tab-content active" id="tab-appearance">
          <div class="style-grid">
            <div class="style-row">
              <label>Font</label>
              <div class="select-wrapper" style="margin: 0; width: 100px;">
                <select id="fontFamilySelect" style="padding: 6px 8px;">
                  <option value="Arial">Arial</option>
                  <option value="Helvetica">Helvetica</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Times New Roman">Times</option>
                  <option value="Verdana">Verdana</option>
                  <option value="Courier New">Courier</option>
                </select>
              </div>
            </div>
            <div class="style-row">
              <label>Font Size</label>
              <input type="number" id="fontSizeInput" class="draggable" value="72" min="24" max="200" title="Click and drag left/right to adjust">
            </div>
            <div class="style-row">
              <label>Text Color</label>
              <div class="color-input-wrapper">
                <input type="color" id="textColorInput" value="#ffffff">
              </div>
            </div>
            <div class="style-row">
              <label>Background</label>
              <div class="color-input-wrapper">
                <input type="color" id="bgColorInput" value="#000000">
              </div>
            </div>
            <div class="toggle-row">
              <label for="mirrorCheckbox">Mirror (Horizontal)</label>
              <label class="toggle">
                <input type="checkbox" id="mirrorCheckbox">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <label for="flipCheckbox">Flip (Vertical)</label>
              <label class="toggle">
                <input type="checkbox" id="flipCheckbox">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Cue Markers Tab -->
        <div class="tab-content" id="tab-cues">
          <button class="btn" id="addCueBtn" style="width: 100%; justify-content: center; margin-bottom: 10px;">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Add Cue at Cursor
          </button>
          <div class="cue-list" id="cueList">
            <div class="no-cues">No cue markers. Add markers to quickly jump to sections.</div>
          </div>
        </div>

        <!-- Remote Tab -->
        <div class="tab-content" id="tab-remote">
          <div class="remote-status">
            <div class="status-dot" id="remoteStatusDot"></div>
            <span id="remoteStatusText">Remote control off</span>
          </div>
          <div class="button-row">
            <button class="btn success" id="startRemoteBtn">Start Server</button>
            <button class="btn" id="stopRemoteBtn">Stop</button>
          </div>
          <div class="remote-url" id="remoteUrlBox" style="display: none;">
            <div class="qr-container">
              <img id="remoteQrCode" alt="QR Code" style="width: 150px; height: 150px; border-radius: 8px; background: white; padding: 8px;">
            </div>
            <div class="remote-url-label">Scan QR code or open URL:</div>
            <div class="remote-url-text" id="remoteUrl"></div>
          </div>
        </div>
      </div>

      <!-- Keyboard shortcuts -->
      <div class="keyboard-hints">
        <h4>Keyboard Shortcuts</h4>
        <div class="hint-row">
          <span>Play / Pause</span>
          <kbd class="kbd">Space</kbd>
        </div>
        <div class="hint-row">
          <span>Speed +/-</span>
          <kbd class="kbd">↑</kbd> <kbd class="kbd">↓</kbd>
        </div>
        <div class="hint-row">
          <span>Jump Start/End</span>
          <kbd class="kbd">Home</kbd> <kbd class="kbd">End</kbd>
        </div>
      </div>
    </aside>
  </main>

  <!-- Cue Name Modal -->
  <div class="modal-overlay" id="cueModal">
    <div class="modal">
      <h3>Add Cue Marker</h3>
      <input type="text" id="cueNameInput" placeholder="Enter cue name...">
      <div class="modal-buttons">
        <button class="btn" id="cueCancelBtn">Cancel</button>
        <button class="btn primary" id="cueSaveBtn">Add Cue</button>
      </div>
    </div>
  </div>

  <script src="js/operator.js"></script>
</body>
</html>
